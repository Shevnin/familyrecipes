# Ingredients Block (v1) — Spec

## Цель
Сделать быстрый и “приятный” блок **Ингредиенты** для FamilyRecipes:
- добавление ингредиентов строками (**ингредиент / количество / единица**)
- снизу **чипы-подсказки** (типовые: мука, яйца и т.п.)
- значения из чипов/дефолтов отображаются **серым** как “предустановленные” (*suggested*) до подтверждения

---

## Шаги флоу
1. Пользователь открывает экран создания/редактирования рецепта → секция **Ингредиенты**.
2. В активной строке начинает вводить ингредиент или выбирает чип снизу.
3. Выбранный чип подставляет ингредиент (и при необходимости дефолтную единицу) **серым**.
4. Фокус переходит в поле количества → ввод/выбор количества.
5. Выбор единицы (селектор или чип единицы).
6. Enter / “+” добавляет следующую строку.
7. При сохранении рецепта предустановленные значения **автоподтверждаются** и сохраняются.

---

## Экраны / UI

### Секция “Ингредиенты” (внутри Create/Edit Recipe)

**A. Список строк**
Каждая строка:
- Ingredient (text)
- Amount (number)
- Unit (dropdown)
- Delete (×)

Пример:
- `[Мука________] [200] [г ▾] (×)`

**B. Чипы-подсказки (под активной строкой)**
Горизонтальный скролл чипов, контекстный к активному полю/строке:
- Частые ингредиенты: `Мука`, `Яйца`, `Сахар`, `Молоко`…
- Чипы количества: `50`, `100`, `200`, `1`, `2`
- Чипы единиц: `г`, `мл`, `шт`, `ст.л.`, `ч.л.`

Состояния:
- Если поле ингредиента пустое → показываем “Частые” + “Недавние”.
- Если пользователь вводит текст → показываем релевантные (prefix match + популярные).

---

## Behavior rules

### 1) Suggested / предустановленные значения (серым)
Серым показываем:
- значения, пришедшие из чипов
- значения, выставленные дефолтом (например, `Яйцо → шт`)

Переход в “подтверждённое” (тёмное) происходит если:
- пользователь вручную изменил поле (любой ввод/правка)
- пользователь перешёл на следующую строку (Enter / “+”)
- пользователь нажал “Сохранить” (автоподтверждение)

> Placeholder ≠ suggested: placeholder — пустое поле; suggested — поле заполнено, но серым.

### 2) Автофокус
- Тап по чипу ингредиента → заполняем Ingredient серым → фокус в Amount.
- После ввода Amount → фокус в Unit (или остаётся в Amount, если Unit выбран чипом единицы).

### 3) Замена значений чипом
- Если поле серое (suggested) → чип заменяет без подтверждений.
- Если поле уже тёмное (подтверждённое) → **v1 default**: заменяем сразу (без диалога).
  - nice-to-have: undo-тост “Заменено. Отменить”.

### 4) Валидация
- Можно сохранить строку без количества/единицы (например “Соль по вкусу”).
- Блокирующих ошибок в v1 нет.
- optional: мягкое предупреждение на строках без Amount/Unit (не блокирует).

### 5) Парсинг дробей (локаль)
- Amount принимает `0.5` и `0,5` (ввод с запятой конвертируем в точку).

---

## Acceptance criteria

### Чипы
- [ ] При пустом вводе ингредиента отображаются “Частые” и “Недавние” чипы.
- [ ] При вводе текста подсказки обновляются и соответствуют введённому префиксу.
- [ ] Тап по чипу ингредиента заполняет поле ингредиента и переводит фокус в количество.

### Suggested (серый)
- [ ] Любое значение из чипа/дефолта отображается серым.
- [ ] Ручная правка делает значение тёмным (подтвержденным).
- [ ] Переход на следующую строку (Enter/+) подтверждает текущие серые значения.
- [ ] Нажатие “Сохранить” автоподтверждает все серые значения и сохраняет рецепт.

### Список ингредиентов
- [ ] Можно добавить новую строку через Enter / “+”.
- [ ] Можно удалить строку через (×).
- [ ] Список корректно отображается на просмотре рецепта (чистый список, без серых состояний).

---

## Варианты (2) + default
**Variant A (Default, v1):**
- Suggested (серое) автоподтверждается при переходе на новую строку и при сохранении.
- Замена подтверждённых значений чипом происходит сразу.

**Variant B (Stricter):**
- Suggested остаётся “неподтверждённым” до явного Done/Enter в поле.
- При сохранении показываем “Проверь ингредиенты” с подсветкой серых.

Default = Variant A.

---

## Non-goals (v1)
- Автопарсинг одной строкой “мука 200 г” (можно добавить позже).
- Drag&drop сортировка строк.
- Полная нормализация ингредиентов (синонимы/категории/аллергены).

---

## Microcopy (v1)
- Ingredient placeholder: “Ингредиент (например, мука)”
- Amount placeholder: “0”
- Unit placeholder: “Ед.”

---

## Decision log (добавить одной строкой)
- Ingredients v1: строки (ингредиент/кол-во/ед.) + чипы-подсказки; значения из чипов/дефолтов показываем серым как suggested и автоподтверждаем при переходе/сохранении (Variant A default).

---

## Next
1. Прототип: нарисовать 2 состояния (пусто + активная строка с чипами) и серое suggested для 3 полей.
2. Добавить microcopy из блока выше.
3. Переходим к следующему шагу core flow: “Сохранить рецепт → найти в Мои рецепты”.