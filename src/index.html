<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Семейные рецепты</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      height: 100vh;
      display: flex; justify-content: center; align-items: center; gap: 32px;
      background: #e8e8ed;
    }

    .phone {
      width: 375px; height: 812px;
      border-radius: 40px;
      background: #fff;
      box-shadow: 0 8px 40px rgba(0,0,0,.18), inset 0 0 0 3px #d1d1d6;
      display: flex; flex-direction: column;
      overflow: hidden;
      position: relative;
    }

    .phone-notch {
      width: 150px; height: 28px;
      background: #000; border-radius: 0 0 18px 18px;
      margin: 0 auto;
      position: relative; z-index: 1;
    }

    .phone-screen {
      flex: 1; padding: 16px 20px 24px;
      display: flex; flex-direction: column;
      overflow-y: auto;
    }

    .phone-mom .phone-screen { background: #fafafa; }
    .phone-son .phone-screen { background: #fff; }

    .phone-label {
      text-align: center; font-size: 13px; font-weight: 600;
      color: #666; margin-top: 12px; letter-spacing: 0.5px;
    }

    h1 { font-size: 20px; margin-bottom: 16px; }

    label { display: block; font-weight: 500; margin-bottom: 4px; font-size: 14px; }
    input[type="text"] {
      width: 100%; padding: 10px 12px; font-size: 15px;
      border: 1px solid #ccc; border-radius: 10px; margin-bottom: 12px;
    }
    textarea {
      width: 100%; flex: 1; padding: 12px; font-size: 15px;
      border: 1px solid #ccc; border-radius: 10px; resize: none;
      margin-bottom: 12px; min-height: 160px;
    }
    button {
      padding: 12px 24px; font-size: 15px; font-weight: 600;
      background: #007aff; color: #fff; border: none; border-radius: 12px;
      cursor: pointer; align-self: stretch; text-align: center;
    }
    button:hover { background: #0066d6; }

    .status { margin-top: 10px; color: #2e7d32; font-weight: 500; font-size: 14px; text-align: center; }

    .tabs {
      display: flex; gap: 0; margin-bottom: 16px;
      border-bottom: 2px solid #e0e0e0;
    }
    .tab {
      flex: 1; padding: 10px 0; font-size: 14px; font-weight: 600;
      background: none; color: #999; border: none; border-bottom: 2px solid transparent;
      margin-bottom: -2px; cursor: pointer; border-radius: 0;
    }
    .tab:hover { color: #666; background: none; }
    .tab.active { color: #007aff; border-bottom-color: #007aff; }

    .tab-content { display: none; flex-direction: column; flex: 1; }
    .tab-content.active { display: flex; }

    .sent-list { list-style: none; padding: 0; }
    .sent-item {
      padding: 12px; margin-bottom: 8px;
      background: #f5f5f5; border-radius: 10px;
    }
    .sent-item-title { font-weight: 600; font-size: 14px; margin-bottom: 4px; }
    .sent-item-recipient { font-size: 12px; color: #007aff; margin-bottom: 4px; }
    .sent-item-preview { font-size: 13px; color: #666; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

    .recipient-toggle {
      display: flex; gap: 0; margin-bottom: 12px;
      background: #f0f0f5; border-radius: 10px; padding: 3px;
    }
    .recipient-btn {
      flex: 1; padding: 8px 0; font-size: 14px; font-weight: 600;
      background: none; color: #666; border: none; border-radius: 8px;
      cursor: pointer;
    }
    .recipient-btn:hover { background: none; color: #333; }
    .recipient-btn.active { background: #fff; color: #007aff; box-shadow: 0 1px 4px rgba(0,0,0,.1); }

    .empty { color: #999; font-style: italic; margin-top: 60px; text-align: center; font-size: 15px; }

    .original {
      background: #f5f0e8; border-left: 3px solid #c9a96e;
      padding: 12px; border-radius: 8px; white-space: pre-wrap;
      font-size: 14px; line-height: 1.5; margin-bottom: 16px;
    }
    .original-label, .structured-label {
      font-weight: 600; font-size: 12px; text-transform: uppercase;
      letter-spacing: 0.5px; color: #888; margin-bottom: 6px;
    }

    .structured { font-size: 14px; line-height: 1.5; }
    .structured h3 { font-size: 15px; margin: 12px 0 6px; }
    .structured h3:first-child { margin-top: 0; }
    .structured ul, .structured ol { padding-left: 18px; }
    .structured li { margin-bottom: 3px; }

    @media (max-width: 840px) {
      body { flex-direction: column; height: auto; padding: 16px; gap: 16px; }
      .phone { width: 100%; max-width: 375px; height: 700px; }
    }
  </style>
</head>
<body>

  <!-- Мама -->
  <div>
    <div class="phone phone-mom">
      <div class="phone-notch"></div>
      <div class="phone-screen">
        <h1>Мама</h1>
        <div class="tabs">
          <button class="tab active" data-tab="new">Новый рецепт</button>
          <button class="tab" data-tab="sent">Отправленные</button>
        </div>
        <div class="tab-content active" id="tab-new">
          <label for="title">Название рецепта</label>
          <input type="text" id="title" placeholder="Например: Борщ бабушкин">
          <label for="body">Рецепт</label>
          <textarea id="body" placeholder="Пиши как в мессенджере — свободно, своими словами…"></textarea>
          <label>Кому</label>
          <div class="recipient-toggle">
            <button class="recipient-btn active" data-recipient="son">Сыну</button>
            <button class="recipient-btn" data-recipient="daughter">Дочке</button>
          </div>
          <button id="send">Отправить</button>
          <div class="status" id="status"></div>
        </div>
        <div class="tab-content" id="tab-sent">
          <ul class="sent-list" id="sent-list"></ul>
          <p class="empty" id="sent-empty">Пока ничего не отправлено</p>
        </div>
      </div>
    </div>
    <div class="phone-label">Передатчик</div>
  </div>

  <!-- Получатель -->
  <div>
    <div class="phone phone-son">
      <div class="phone-notch"></div>
      <div class="phone-screen">
        <h1 id="receiver-title">Сын</h1>
        <div class="tabs" id="receiver-tabs">
          <button class="tab active" data-receiver="son">Сын</button>
          <button class="tab" data-receiver="daughter">Дочка</button>
        </div>
        <div id="receiver-content-son">
          <p class="empty">Пока ничего</p>
        </div>
        <div id="receiver-content-daughter" style="display:none">
          <p class="empty">Пока ничего</p>
        </div>
      </div>
    </div>
    <div class="phone-label">Мастер</div>
  </div>

  <script>
    const titleInput = document.getElementById('title');
    const bodyInput = document.getElementById('body');
    const sendBtn = document.getElementById('send');
    const status = document.getElementById('status');
    const sentList = document.getElementById('sent-list');
    const sentEmpty = document.getElementById('sent-empty');

    // Табы мамы (Новый рецепт / Отправленные)
    document.querySelectorAll('.phone-mom .tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.phone-mom .tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        document.querySelectorAll('.phone-mom .tab-content').forEach(c => c.classList.remove('active'));
        document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
      });
    });

    // Выбор получателя у мамы
    let selectedRecipient = 'son';
    const recipientLabels = { son: 'сыну', daughter: 'дочке' };
    const recipientNames = { son: 'Сын', daughter: 'Дочка' };

    document.querySelectorAll('.recipient-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.recipient-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        selectedRecipient = btn.dataset.recipient;
      });
    });

    // Табы получателя (Сын / Дочка)
    document.querySelectorAll('#receiver-tabs .tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('#receiver-tabs .tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        const r = tab.dataset.receiver;
        document.getElementById('receiver-content-son').style.display = r === 'son' ? '' : 'none';
        document.getElementById('receiver-content-daughter').style.display = r === 'daughter' ? '' : 'none';
        document.getElementById('receiver-title').textContent = recipientNames[r];
      });
    });

    const sentRecipes = [];

    // Экранирование HTML
    function esc(str) {
      const d = document.createElement('div');
      d.textContent = str;
      return d.innerHTML;
    }

    // Парсинг маминого текста в структурированную версию
    function parseRecipe(text) {
      const lines = text.split('\n').map(l => l.trim()).filter(l => l.length > 0);
      if (lines.length === 0) return '<p style="color:#999">Пусто — нечего разбирать</p>';

      // Паттерн для ингредиентов: строка содержит число + единицу измерения
      const unitPattern = /\d+\s*(г|гр|кг|мл|л|шт|ст\.?\s*л|ч\.?\s*л|стакан|щепот|пучок|зубч|долек|долька|банк|пачк|упаковк)/i;
      // Или строка с "по вкусу", "на глаз"
      const tastePattern = /по вкусу|на глаз/i;

      const ingredients = [];
      const steps = [];

      for (const line of lines) {
        if (unitPattern.test(line) || tastePattern.test(line)) {
          ingredients.push(line);
        } else {
          steps.push(line);
        }
      }

      let html = '';

      if (ingredients.length > 0) {
        html += '<h3>Ингредиенты</h3><ul>';
        for (const ing of ingredients) {
          html += `<li>${esc(ing)}</li>`;
        }
        html += '</ul>';
      }

      if (steps.length > 0) {
        html += '<h3>Шаги</h3><ol>';
        for (const step of steps) {
          html += `<li>${esc(step)}</li>`;
        }
        html += '</ol>';
      }

      if (!html) {
        html = '<p style="color:#999">Не удалось разобрать — попробуй написать ингредиенты с количествами</p>';
      }

      return html;
    }

    sendBtn.addEventListener('click', () => {
      const title = titleInput.value.trim();
      const body = bodyInput.value.trim();

      if (!body) return;

      const recipient = selectedRecipient;

      // Сохранить в отправленные
      sentRecipes.push({ title: title || 'Без названия', body, recipient });
      sentEmpty.style.display = 'none';
      const li = document.createElement('li');
      li.className = 'sent-item';
      li.innerHTML = `<div class="sent-item-recipient">${esc(recipientNames[recipient])}</div><div class="sent-item-title">${esc(title || 'Без названия')}</div><div class="sent-item-preview">${esc(body)}</div>`;
      sentList.prepend(li);

      // Показать статус у мамы
      status.textContent = `Отправлено ${recipientLabels[recipient]}!`;

      // Показать у получателя
      const heading = title ? `<h2 style="margin-bottom:16px">${esc(title)}</h2>` : '';
      const contentEl = document.getElementById('receiver-content-' + recipient);

      contentEl.innerHTML = `
        ${heading}
        <div class="original-label">Оригинал от мамы</div>
        <div class="original">${esc(body)}</div>
        <div class="structured-label">Структурированная версия</div>
        <div class="structured">${parseRecipe(body)}</div>
      `;
    });
  </script>

</body>
</html>
